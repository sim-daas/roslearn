<?xml version="1.0" ?>
<robot name="turtlebot3_waffle_pi" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:include filename="$(find turtlebot3_gazebo)/urdf/common_properties.urdf.xacro"/>
  <xacro:include filename="$(find robot_description)/urdf/lid/lid.xacro"/>

  <!-- Existing TurtleBot3 links and joints -->

  <!-- Storage Box with Lid -->
  <joint name="storage_box_joint" type="fixed">
    <origin xyz="-0.08 0 0.14" rpy="0 0 0"/>
    <parent link="base_link"/>
    <child link="storage_box_link"/>
  </joint>

  <link name="storage_box_link">
    <visual>
      <origin xyz="0 0 0.025" rpy="0 0 0"/>
      <geometry>
        <box size="0.15 0.12 0.05"/>
      </geometry>
      <material name="box_material">
        <color rgba="0.8 0.6 0.4 1.0"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0.025" rpy="0 0 0"/>
      <geometry>
        <box size="0.15 0.12 0.05"/>
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 0.025" rpy="0 0 0"/>
      <mass value="0.2"/>
      <inertia ixx="0.0004" ixy="0" ixz="0" iyy="0.0005" iyz="0" izz="0.0006"/>
    </inertial>
  </link>

  <!-- Hinged Lid -->
  <joint name="lid_joint" type="revolute">
    <origin xyz="-0.075 0 0.05" rpy="0 0 0"/>
    <parent link="storage_box_link"/>
    <child link="lid_link"/>
    <axis xyz="0 1 0"/>
    <limit lower="0" upper="1.5708" effort="10" velocity="1.0"/>
    <dynamics damping="0.1" friction="0.01"/>
  </joint>

  <link name="lid_link">
    <visual>
      <origin xyz="0.075 0 0.0125" rpy="0 0 0"/>
      <geometry>
        <box size="0.15 0.12 0.025"/>
      </geometry>
      <material name="lid_material">
        <color rgba="0.6 0.4 0.2 1.0"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0.075 0 0.0125" rpy="0 0 0"/>
      <geometry>
        <box size="0.15 0.12 0.025"/>
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0.075 0 0.0125" rpy="0 0 0"/>
      <mass value="0.1"/>
      <inertia ixx="0.0002" ixy="0" ixz="0" iyy="0.0003" iyz="0" izz="0.0003"/>
    </inertial>
  </link>

  <!-- Gazebo materials -->
  <gazebo reference="storage_box_link">
    <material>Gazebo/Wood</material>
  </gazebo>
  
  <gazebo reference="lid_link">
    <material>Gazebo/WoodPallet</material>
  </gazebo>

  <!-- Gazebo ROS2 Control Plugin -->
  <gazebo>
    <plugin filename="libgazebo_ros2_control.so" name="gazebo_ros2_control">
      <robot_param>robot_description</robot_param>
      <robot_param_node>robot_state_publisher</robot_param_node>
      <parameters>$(find lid_control)/config/lid_controllers.yaml</parameters>
    </plugin>
  </gazebo>

</robot>